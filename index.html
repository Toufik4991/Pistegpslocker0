<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>üåù ‚òùÔ∏è üß≠</title>
    <style>
        :root { 
            --gold: #d4af37; --bg: #0a0a0a; --parchment: #fdfaf0;
            --green: #00ff41; --orange: #ff8c00; --red: #ff4500; 
        }
        
        body { 
            background: #000; color: white; font-family: -apple-system, sans-serif; 
            margin: 0; overflow: hidden; height: 100vh;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- CADRE VISUEL --- */
        #game-container {
            width: 95%; max-width: 450px; height: 85vh;
            background: var(--bg); border: 2px solid var(--gold);
            border-radius: 25px; position: relative; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,1);
        }

        /* --- HALO DE BORDURE (LOGIQUE GPS) --- */
        #nav-halo {
            position: absolute; inset: 0;
            border: 0px solid transparent; transition: all 0.6s ease;
            pointer-events: none; z-index: 5; border-radius: 22px;
        }

        /* --- ECRANS --- */
        .screen { 
            position: absolute; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px; text-align: center;
        }
        
        #setup-screen { z-index: 100; background: radial-gradient(circle, #1a1a1a, #000); }
        #nav-screen { z-index: 10; display: none; }
        #game-screen { z-index: 200; display: none; background: rgba(0,0,0,0.9); }

        /* --- BOUSSOLE MODERNE --- */
        .compass {
            width: 100px; height: 100px; border: 3px solid var(--gold);
            border-radius: 50%; position: relative; background: #1a1a1a;
            margin-bottom: 20px;
        }
        #needle {
            width: 4px; height: 40px; background: linear-gradient(to bottom, var(--red) 50%, #fff 50%);
            position: absolute; top: 10px; left: 48px; transform-origin: bottom center;
            transition: transform 0.3s ease-out;
        }

        /* --- PARCHEMIN MODERNE --- */
        .parchment {
            background: var(--parchment); color: #2c3e50;
            padding: 25px; border-radius: 15px; width: 85%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .btn { 
            background: var(--gold); color: black; border: none; 
            padding: 15px 30px; border-radius: 30px; font-weight: bold; 
            text-transform: uppercase; cursor: pointer; margin-top: 15px;
        }

        #timer-ui { position: absolute; top: 15px; right: 20px; color: var(--gold); font-size: 0.8rem; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="nav-halo"></div>
    <div id="timer-ui">00:00</div>

    <div id="setup-screen" class="screen">
        <h1 style="font-size: 3rem; margin:0;">üåù ‚òùÔ∏è üß≠</h1>
        <p style="color:var(--gold); letter-spacing:2px;">SAUMUR QUEST</p>
        <input type="text" id="player-name" placeholder="Pseudo..." style="padding:10px; border-radius:8px; border:1px solid var(--gold); background:none; color:white; margin:20px 0;">
        <button class="btn" onclick="initNewGame()">Commencer</button>
    </div>

    <div id="nav-screen" class="screen">
        <div class="compass">
            <div id="needle"></div>
            <div style="position:absolute; top:5px; left:46px; color:var(--gold); font-size:10px; font-weight:bold;">N</div>
        </div>
        
        <div class="parchment">
            <h3 id="nav-msg">Initialisation...</h3>
            <div id="radar-dist" style="font-size: 3rem; font-weight: 900;">---</div>
            <p id="player-display" style="font-style:italic; font-size:0.8rem;"></p>
            <div id="zone-action-btn" style="display:none;">
                <button class="btn" onclick="launchMiniGame()">Lancer le D√©fi</button>
            </div>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div id="game-inject" style="width:100%;"></div>
    </div>
</div>

<script>
    // TES POINTS GPS (Inchang√©s)
    const GPS = [
        { lat: 47.258652, lon: -0.072320 }, 
        { lat: 47.259223, lon: -0.074964 }
    ];

    let playerName = "", currentStep = 0, seconds = 0;

    function initNewGame() {
        playerName = document.getElementById('player-name').value || "Explorateur";
        document.getElementById('player-display').innerText = "Explorateur : " + playerName;
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('nav-screen').style.display = 'flex';
        
        // Timer
        setInterval(() => {
            seconds++;
            let m = Math.floor(seconds/60).toString().padStart(2,'0');
            let s = (seconds%60).toString().padStart(2,'0');
            document.getElementById('timer-ui').innerText = `${m}:${s}`;
        }, 1000);

        navigator.geolocation.watchPosition(updateGPS, null, { enableHighAccuracy: true });
    }

    function updateGPS(pos) {
        const target = GPS[currentStep];
        const lat = pos.coords.latitude; 
        const lon = pos.coords.longitude;
        const dist = calculateDistance(lat, lon, target.lat, target.lon);
        
        // Boussole
        const angle = Math.atan2(target.lon - lon, target.lat - lat) * (180 / Math.PI);
        document.getElementById('needle').style.transform = `translateX(-50%) rotate(${angle}deg)`;

        // Radar Distance
        document.getElementById('radar-dist').innerText = Math.round(dist) + "m";
        
        // Logique Halo & Bouton
        const h = document.getElementById('nav-halo');
        const btn = document.getElementById('zone-action-btn');
        const msg = document.getElementById('nav-msg');
        
        h.style.borderWidth = "15px";
        if(dist > 100) { 
            h.style.borderColor = "var(--red)"; msg.innerText = "Cherchez..."; btn.style.display='none'; 
        } else if(dist > 35) { 
            h.style.borderColor = "var(--orange)"; msg.innerText = "Approche..."; btn.style.display='none'; 
        } else { 
            h.style.borderColor = "var(--green)"; msg.innerText = "ZONE ATTEINTE"; btn.style.display='block'; 
        }
    }

    // FONCTION POUR TES FUTURS JEUX PERSONNALIS√âS
    function launchMiniGame() {
        document.getElementById('game-screen').style.display = 'flex';
        const container = document.getElementById('game-inject');
        
        // C'est ici que tu personnaliseras selon l'√©tape
        if(currentStep === 0) {
            container.innerHTML = `
                <div class="parchment">
                    <h2>D√âFI N¬∞1</h2>
                    <p>Bravo ${playerName}. Tape 3 fois sur la lune pour continuer.</p>
                    <button class="btn" onclick="validateStep()">R√©ussir</button>
                </div>`;
        } else {
            container.innerHTML = `<div class="parchment"><h2>D√âFI SUIVANT</h2><button class="btn" onclick="validateStep()">Continuer</button></div>`;
        }
    }

    function validateStep() {
        currentStep++;
        document.getElementById('game-screen').style.display = 'none';
        if(currentStep >= GPS.length) alert("F√©licitations, qu√™te termin√©e !");
    }

    function calculateDistance(la1, lo1, la2, lo2) {
        const R = 6371000;
        const dLat = (la2-la1)*Math.PI/180; const dLon = (lo2-lo1)*Math.PI/180;
        const a = Math.sin(dLat/2)**2 + Math.cos(la1*Math.PI/180)*Math.cos(la2*Math.PI/180)*Math.sin(dLon/2)**2;
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }
</script>
</body>
</html>
